<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sincronizador de Portapapeles (Simple)</title>
    <!-- Incluye Tailwind CSS para un diseño moderno y responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container-app {
            min-height: 100vh;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center p-4">
    <div class="container-app w-full max-w-2xl bg-white shadow-xl rounded-2xl p-6 md:p-10 flex flex-col space-y-6">
        <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 text-center">
            Sincronizador de Portapapeles
        </h1>
        <p class="text-gray-600 text-center">
            Copia y pega texto entre tus dispositivos en tiempo real.
        </p>

        <div class="bg-indigo-50 border border-indigo-200 text-indigo-800 rounded-lg p-4 flex flex-col space-y-2">
            <label class="text-sm font-semibold">Tu ID de Dispositivo:</label>
            <div id="userIdDisplay" class="bg-white border border-indigo-300 rounded-md p-2 font-mono text-sm break-words select-all cursor-pointer">Cargando...</div>
        </div>

        <div id="statusMessage" class="text-center text-sm mt-4 text-gray-500"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Establecer nivel de log para depuración
        setLogLevel('debug');

        // Configuración de Firebase - ¡Esta es la clave!
        // Las credenciales son proporcionadas automáticamente por el entorno.
        const firebaseConfig = JSON.parse(__firebase_config);

        // Elementos del DOM
        const userIdDisplay = document.getElementById('userIdDisplay');
        const statusMessage = document.getElementById('statusMessage');

        /**
         * Muestra un mensaje de estado en la UI.
         * @param {string} message El mensaje a mostrar.
         * @param {string} type El tipo de mensaje ('success', 'error', 'info').
         */
        const showStatus = (message, type = 'info') => {
            let color = '';
            if (type === 'success') color = 'text-green-500';
            else if (type === 'error') color = 'text-red-500';
            else color = 'text-gray-500';
            statusMessage.textContent = message;
            statusMessage.className = `text-center text-sm mt-4 ${color}`;
        };

        /**
         * Inicializa la app y la autenticación de Firebase.
         */
        const initializeFirebase = async () => {
            try {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);

                // Autenticar de forma anónima y obtener el ID de usuario
                const userCredential = await signInAnonymously(auth);
                const user = userCredential.user;
                
                if (user) {
                    userIdDisplay.textContent = user.uid;
                    showStatus("¡Autenticación exitosa! Tu ID de dispositivo se muestra arriba.", "success");
                } else {
                    userIdDisplay.textContent = "Error";
                    showStatus("Error de autenticación. No se pudo iniciar sesión.", "error");
                }

            } catch (error) {
                console.error("Error al inicializar Firebase:", error);
                userIdDisplay.textContent = "Error";
                showStatus(`Error de inicialización: ${error.message}. Este error indica un problema con la configuración de Firebase.`, "error");
            }
        };

        // Inicializar la aplicación al cargar la ventana
        window.onload = initializeFirebase;
    </script>
</body>
</html>
